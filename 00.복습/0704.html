<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>입력 리스트 만들기</title>
    <!-- GOOGLE ICON -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=delete_sweep" />
    <style>
        /* 구글 아이콘 스타일 설정 */
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24+
        }
    </style>

    <style>
        /* 입력 리스트 아이템 구성용 스타일 */
        .item {
            display: flex;
            justify-content: left;
            gap: 10px;
            border: 1px solid;
            padding: 5px;
        }

        .item>.left {
            border: 1px solid;
            position: relative;
            min-width: 200px;
        }

        .item>.left>input {
            width: 100%;
            outline: none;
            border: 0;
            height: 95%;
            padding: 0;
            margin: 0;
            position: absolute;
            left: 0;
            top: 0;
        }

        .item>.right {
            border: 1px solid;
        }

        .item>.right>a {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <input class="insert-value" type="text"> | <a href="javascript:void(0)" class="btn btn-input">입력</a>
    <!-- 사용자가 입력할 <input> 박스 | <a>로 입력을 만들고 그것을 btn-input으로 버튼식으로 활용 -->
    <hr />
    <!-- 입력값이 추가될 리스트 영역 -->
    <div class="container">
        <!-- <div class="item">
            <div class="left">
                <input type="text" readonly> readonly 읽기전용
            </div>
            <div class="right">
                <a href="javascript:void(0)">
                    <span class="material-symbols-outlined">delete_sweep
                    |   delete
                    </span>
                </a>
            </div>
        </div> -->
    </div>

    <script>
        // HTML 문서가 완전히 로딩되었을때 실행
        window.addEventListener('DOMContentLoaded', () => {
        //→ 이 코드는 HTML이 다 불러졌을 때 안의 코드를 실행해줘.
        //   왜 쓰냐면? → HTML이 먼저 안 뜨면 querySelector()로 요소를 찾을 수가 없기 때문이야.
        //    무조건 문서 로드 후 실행시켜야 안정적임. 

            //전역스코프 요소검색
            // 필요한 DOM 요소들을 변수에 담아둠
            const insertEl = document.querySelector('.insert-value');
            const insertBtnEl = document.querySelector('.btn-input');
            const containerEl = document.querySelector('.container');

            // 이벤트 처리 등록(입력 버튼을 클릭했을 때)
            insertBtnEl.addEventListener('click', () => {
                const text = insertEl.value; // 입력값 가져오기

                if(!isValid(text)){ // 입력값 유효성 검사(false가 나오면 종료)
                    return ;  // 라인이 한줄이면 {} 생략가능
                }
                //container에 item 추가
                createNode(text); // 입력값을 가지고 새로운 리스트 항목 생성
                insertEl.value = ""; // 노드생성후 입력값을 비워줌

            })

            // 입력창에서 엔터 키 누를 때도 동일한 동작 수행
            insertEl.addEventListener('keydown', (e) => {
                // console.log(e);
                if (e.keyCode == 13) { // keyCode 13 = 엔터
                    const text = insertEl.value
                    if(!isValid(text)){ // 유효하지 않다면(false가 나오면)
                        return ;  // 라인이 한줄이면 {} 생략가능
                }
                    //container에 item 추가
                    createNode(text);
                    insertEl.value = ""; // 노드생성후 입력값을 비워줌
                }
            });


            //노드추가 함수 생성(Hosting 적용)
            // 새로운 아이템을 만드는 함수 정의 
            function createNode(text) {
                
                // 새노드 생성 //요소를 생성
                const itemEl = document.createElement('div'); // 전체 아이템
                const leftEl = document.createElement('div'); // 왼쪽 input영역
                const inputEl = document.createElement('input'); // 실제 input

                const rightEl = document.createElement('div'); // 오른쪽 삭제버튼 영역
                const aEl = document.createElement('a'); // 삭제버튼
                const spanEl = document.createElement('span'); // 아이콘(span)

                // 클래스 적용 // 클래스명 지정
                itemEl.className = 'item';
                leftEl.className = 'left';
                rightEl.className = 'right';
                spanEl.className = 'material-symbols-outlined'

                // 속성 추가
                inputEl.setAttribute('readonly', true) // 입력된 input은 읽기전용
                aEl.setAttribute('href', 'javascript:void(0)') // 링크로 이동 안하게 처리

                // 데이터 삽입
                spanEl.innerHTML = 'delete_sweep'; // 아이콘텍스트 설정
                inputEl.value = text; // 입력값을 input에 넣음

                // 이벤트 추가(클릭시 삭제)
                aEl.addEventListener('click', (e) => {
                    const itemEl = e.target.parentNode.parentNode.parentNode;
                    itemEl.remove();
                    // console.log(e.target.parentNode.parentNode.parentNode);
                });

                // aEl.addEventListener('click', (e) => {
                //     const itemEl = e.currentTarget.closest('.item');
                        // //    e.currentTarget 이벤트가 등록된 대상, closest('.item')위로 올라가면서 가장 가까운 .item 찾기 = 클릭 위치가 span이든 a든 상관없이 항상 정확하게 작동
                //     itemEl.remove();
                // });

                // 노드간 연결
                leftEl.appendChild(inputEl); // input → left
                aEl.appendChild(spanEl);    // 아이콘 → a
                rightEl.appendChild(aEl);   // a → right

                itemEl.appendChild(leftEl); // left → item
                itemEl.appendChild(rightEl); // right → item
                containerEl.appendChild(itemEl); // itme →→ container(리스트에 추가) // 추가한내용 밑에서부터 채우기 
                // containerEl.prepend(itemEl); // 추가한내용이 위에서부터 채우기

            }

            // 유효성 검사 함수(빈 값 또는 숫자로 시작하면 경고(alert))
            function isValid(text){
                const regex = /^[0-9]/; // 첫글자가 숫자인지 확인
                //  정규표현식 문법임. regex 정규표현식 함수 사용가능

                // 입력이 비었거나 공백만 있을 때
                if(text.trim()===''||text.trim()===null){ // 문자 앞뒤공백 제거 
                    alert("내용을 입력하세요");
                    return false
                }
                // 숫자로 시작하면 경고(alert)
                if(regex.test(text)){ // 외부로서 받은 문자가 정규표현식에 부합되면 트루.
                    alert("첫번째는 숫자를 입력할 수 없습니다.")
                    return false

                };

                return true;
            }

        })
    </script>
</body>

</html>